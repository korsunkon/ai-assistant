# Инструкция по использованию просмотра транскриптов

## Что нового?

В этой версии добавлена возможность просматривать полные транскрипты звонков прямо на странице результатов исследования. Теперь вы можете:

- ✅ Видеть полный текст разговора
- ✅ Изучать детальную транскрипцию с временными метками
- ✅ Сравнивать анализ LLM с реальным содержанием звонка
- ✅ Проверять, на основе каких фраз модель сделала выводы

## Быстрый старт

### 1. Запустите приложение

```bash
cd project-036-enhanced
start.bat
```

Или запустите серверы по отдельности:
```bash
start_backend.bat   # В первом терминале
start_frontend.bat  # Во втором терминале
```

### 2. Откройте браузер

Перейдите на `http://localhost:5173`

### 3. Загрузите звонки

1. Откройте страницу "Звонки" в боковом меню
2. Нажмите "Загрузить файлы"
3. Выберите MP3 или WAV файлы звонков
4. Дождитесь загрузки

### 4. Создайте исследование

1. Откройте страницу "Новое исследование"
2. Введите название исследования
3. Введите ваш исследовательский запрос (например: "Какие возражения клиентов встречаются в звонках?")
4. Выберите звонки для анализа
5. Нажмите "Запустить исследование"

### 5. Просмотрите транскрипты (НОВОЕ!)

1. Дождитесь завершения обработки (статус "Завершено")
2. Откройте страницу "Результаты"
3. Найдите нужный звонок в таблице результатов
4. Нажмите кнопку **"Транскрипт"** в колонке "Действия"

### 6. Изучите транскрипт

В открывшемся окне вы увидите:

#### Верхний блок - Полный текст
- Весь разговор одним текстом
- Удобно для быстрого ознакомления

#### Нижний блок - Детальная транскрипция
- Timeline с каждым сегментом разговора
- Синие и зелёные метки времени:
  - **Синяя метка** - время начала фразы (например: 0:00)
  - **Зелёная метка** - время окончания фразы (например: 0:17)
- Текст каждой фразы отдельно
- Цветовое кодирование для визуального разделения

## Пример использования

### Сценарий: Проверка анализа LLM

1. На странице результатов вы видите, что LLM написал:
   ```
   Краткая выжимка: Клиент заказал продукты
   ```

2. Вы хотите проверить, что именно говорилось в звонке

3. Нажимаете "Транскрипт"

4. Видите полный текст и временные метки:
   ```
   [0:00 - 0:17] что ты отдыхалась маловато конечно...
   [0:17 - 0:21] сегодня
   [0:21 - 0:28] пожалуйста у тебя толку нигде там не завалялся...
   ```

5. Теперь вы можете:
   - Убедиться в точности анализа
   - Найти конкретные цитаты
   - Понять контекст разговора

## Возможные статусы звонков

| Статус | Описание | Доступен транскрипт? |
|--------|----------|---------------------|
| `new` | Только загружен | ❌ Нет |
| `processing` | Обрабатывается | ⚠️ Может быть частично |
| `processed` | Обработан | ✅ Да |
| `error` | Ошибка обработки | ❌ Нет |

## Советы по использованию

### Когда полезно смотреть транскрипт?

1. **Проверка качества анализа**: Убедиться, что LLM правильно понял содержание
2. **Поиск конкретных фраз**: Найти точные формулировки клиентов
3. **Понимание контекста**: Увидеть полную картину разговора
4. **Обучение модели**: Понять, какие фразы модель упустила или неправильно интерпретировала
5. **Извлечение цитат**: Скопировать точные высказывания для отчётов

### Форматирование времени

Время отображается в формате **MM:SS**:
- `0:05` = 5 секунд
- `1:23` = 1 минута 23 секунды
- `12:45` = 12 минут 45 секунд

### Навигация

- Прокручивайте timeline вниз для просмотра всех сегментов
- Используйте полосу прокрутки для быстрого перемещения
- Закройте окно крестиком или кликом вне окна

## Устранение неполадок

### Кнопка "Транскрипт" неактивна
**Причина:** Звонок ещё не обработан
**Решение:** Дождитесь завершения обработки (статус "Завершено")

### Ошибка "Транскрипт недоступен"
**Причина:** Звонок не был обработан или обработка завершилась с ошибкой
**Решение:**
1. Проверьте статус звонка на странице "Звонки"
2. Если статус "error", попробуйте загрузить файл заново
3. Проверьте логи backend на наличие ошибок

### Ошибка "Файл транскрипта не найден"
**Причина:** Файл транскрипта отсутствует в файловой системе
**Решение:**
1. Проверьте наличие файла `data/transcripts/{call_id}.json`
2. Если файла нет, запустите обработку звонка заново

### Модальное окно не открывается
**Причина:** Ошибка JavaScript или проблема с соединением
**Решение:**
1. Откройте консоль браузера (F12)
2. Проверьте наличие ошибок
3. Убедитесь, что backend запущен и доступен
4. Обновите страницу (F5)

## Технические детали

### API Endpoint

```
GET /api/calls/{call_id}/transcript
```

**Параметры:**
- `call_id` - ID звонка (число)

**Ответ:**
```json
{
  "text": "полный текст разговора",
  "segments": [
    {
      "start": 0.0,
      "end": 17.04,
      "text": "текст сегмента"
    }
  ]
}
```

### Требования

- Backend должен быть запущен (порт 8000)
- Frontend должен быть запущен (порт 5173)
- Звонок должен быть обработан (статус "processed")
- Файл транскрипта должен существовать

## Дополнительная информация

Для полной документации см. [README.md](README.md)

Для описания всех изменений см. [CHANGES.md](CHANGES.md)

Для инструкций по установке см. [SETUP.md](SETUP.md)

---

**Версия:** 2.0 (Enhanced)
**Дата:** 2026-01-16
